<!DOCTYPE html>
<html>

<head>
    <title>Project 3</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>

    <style type="text/css">
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #map {
            height: 100%;
        }

        .search-button {
            margin-top: 25px;
            margin-left: auto;
            margin-right: auto;
        }

        .result-screen {
            height: 50%;
        }

        .result-anchor {
            font-size: 32pt;
            font-weight: bold;
            text-align: center;
        }

        .card-element {
            margin: 0 auto;
        }

        .map-screen {
            float: right;
            width: 50%;
            height: 100%;
        }

        .left-screen {
            float: left;
            width: 50%;
        }
    </style>
</head>

<body>
    <div class="left-screen">
        <div class="jumbotron jumbo-screen">
            <h1 class="display-3">City of Chicago Food Inspection</h1>
            <p class="lead"></p>
            <hr class="my-4">
            <p>Provide the information you would like to search.</p>
            <p>
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-3">
                            <h6>Inspection Date</h6>
                            <input type="date" name="inspectionDate" class="inspectionDate">
                        </div>
                        <div class="col-sm-3">
                            <h6>Facility Type</h6>
                            <input type="text" name="facilityType" class="facilityType" />
                        </div>
                        <div class="col-sm-3">
                            <h6>Status</h6>
                            <input type="text" name="status" class="status" />
                        </div>
                        <div class="col-sm-3">
                            <h6>Zip Code</h6>
                            <input type="text" name="zipCode" class="zipCode" />
                        </div>
                        <div class="search-button">
                            <a class="btn btn-primary btn-lg searchButton" href="#" role="button">Search</a>
                        </div>
                    </div>

                </div>

            </p>
        </div>
        <div class="result-screen">
            <div class="card text-white bg-dark mb-3 card-element" style="max-width: 20rem;">
                <div class="card-header">Result Count</div>
                <div class="card-body">
                    <p class="card-text result-anchor">0</p>
                </div>
            </div>
        </div>

    </div>
    <div class="map-screen">
        <div id="map"></div>
    </div>


    <script type="text/javascript">
        /* global $ */
        /* global google */

        $(".searchButton").on("click", function() {
            var paramObj = {};
            var dateObj = { inspection_date: $(".inspectionDate").val() };
            var facilityObj = { facility_type: $(".facilityType").val() };
            var statusObj = { results: $(".status").val() };
            var zipObj = { zip: $(".zipCode").val() }
            var objArr = [dateObj, facilityObj, statusObj, zipObj];
            var valueArr = [$(".inspectionDate").val(), $(".facilityType").val(), $(".status").val(), $(".zipCode").val()];
            //console.log(dateObj);

            // Iterate through array and exclue empty input
            $.each(valueArr, function(index, value) {
                if (value !== '') {
                    $.extend(paramObj, objArr[index]);
                }
            });

            console.clear();
            console.log(paramObj);

            $.get("https://data.cityofchicago.org/resource/cwig-ma7x.json?" + $.param(paramObj), function(response) {
                console.log(response.length);

                if (response.length > 0) {
                    var map = new google.maps.Map(document.getElementById('map'), {
                        zoom: 9,
                        center: { lat: parseFloat(response[0].latitude), lng: parseFloat(response[0].longitude) }
                    });

                    // Update response count
                    $(".result-anchor").text(response.length);

                    $.each(response, function(i, v) {
                        console.log(v);

                        var contentString = "<h6>" + v.aka_name + "</h6>";

                        var infowindow = new google.maps.InfoWindow({
                            content: contentString
                        });

                        var marker = new google.maps.Marker({
                            position: { lat: parseFloat(v.latitude), lng: parseFloat(v.longitude) },
                            map: map,
                            title: v.aka_name
                        });

                        marker.addListener('click', function() {
                            infowindow.open(map, marker);
                        });
                    });
                }
            });
        });
    </script>

    <!-- Google Map API -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBZWWXgcL2aeHUyWyP0w6KvG7j73uFkPpk"></script>
</body>

</html>
